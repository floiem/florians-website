/**
 * @license
 * True Audio Player 1.0.8
 * Audio player plugin for creating robust audio player solutions
 * https://upliftwebdesign.com/true-audio-player
 * 
 * Copyright 2022 Carleton Maybell
 * 
 * Released under the GNU General Public License v3.0 License
 * 
 * Released on: July 25, 2022
 */
!function(t,e,n,i){var r={};function a(t,e,n,i){var r=this;this.id=o(),this.$elem=n,this.targetSetId=i,this.$elem.attr("data-true-audio-player-song-id",this.id),this.$parentElem,this.audio=new Audio,this.audio.preload="metadata",this.audio.src=e,this.title="",this.artist="",this.album="",this.genre="",this.durationString="0:00",this._thumbnail="",this._thumbnailBlob="",this._thumbnailBlobUrl="",this.getThumbnail=function(){return this._thumbnail},this.getThumbnailBlob=function(){return this._thumbnailBlob},this.getThumbnailBlobUrl=function(){return this._thumbnailBlobUrl},this.setThumbnail=function(t){this._thumbnail=t},this.audio.addEventListener("timeupdate",function(e){if(t.isDragging)return!1;var n=e.srcElement.currentTime,i=e.srcElement.duration;t.updateSongDisplayTime(n,i),"setPositionState"in navigator.mediaSession&&navigator.mediaSession.setPositionState({duration:i,playbackRate:e.srcElement.playbackRate,position:n})}),this.audio.addEventListener("volumechange",function(e){var n=100*e.srcElement.volume;t.$volumeBar.width(n+"%")}),this.audio.addEventListener("canplay",function(){}),this.audio.addEventListener("play",function(){t.targetSets[r.targetSetId]&&t.targetSets[r.targetSetId].removeClass("is-buffering"),t.setPlayerState("playing",r),"mediaSession"in navigator&&(navigator.mediaSession.playbackState="playing")}),this.audio.addEventListener("pause",function(){t.setPlayerState("paused",r),"mediaSession"in navigator&&(navigator.mediaSession.playbackState="paused")}),this.audio.addEventListener("waiting",function(){t.targetSets[r.targetSetId]&&t.targetSets[r.targetSetId].addClass("is-buffering")}),this.audio.addEventListener("ended",function(){if(t.isDragging)return!1;1==t.songs.length?t.stopCurrentSong():t.playNextSong()}),this.audio.addEventListener("loadedmetadata",function(){var e=parseInt(r.audio.duration/60,10),n=parseInt(r.audio.duration%60);n=n>=10?n:"0"+n,r.durationString=e+":"+n,r.$parentElem&&r.$parentElem.find('[tmplayer-interaction="populate-duration"]').text(r.durationString),t.getCurrentSong()==r&&t.$duration.text(r.durationString)})}function o(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}function s(e,n){this.$elem=t(e),this.settings=t.extend({},r,n),this._defaults=r,this.init()}s.prototype={init:function(){var e=this;e.id=o(),e.name=e.$elem.attr("tmplayer-init"),e.isDragging=!1,e.songs=[],e.targetSets={},e._volume=1,e._playerState="stopped",e._currentSongIndex=-1,e.tempCurrentTime=0,this.$songName=this.$elem.find('[tmplayer-element="title"]').attr("tmplayer-interaction","monitor-state"),this.$thumbnail=this.$elem.find('[tmplayer-element="thumbnail"]').attr("tmplayer-interaction","monitor-state"),this.$albumName=this.$elem.find('[tmplayer-element="album"]').attr("tmplayer-interaction","monitor-state"),this.$artistName=this.$elem.find('[tmplayer-element="artist"]').attr("tmplayer-interaction","monitor-state"),this.$genre=this.$elem.find('[tmplayer-element="genre"]').attr("tmplayer-interaction","monitor-state"),this.playButton=this.$elem.find('[tmplayer-button="play"]'),this.pauseButton=this.$elem.find('[tmplayer-button="pause"]'),this.nextButton=this.$elem.find('[tmplayer-button="next"]'),this.previousButton=this.$elem.find('[tmplayer-button="previous"]'),this.stopButton=this.$elem.find('[tmplayer-button="stop"]'),this.volumeUpButton=this.$elem.find('[tmplayer-button="volume-up"]'),this.volumeDownButton=this.$elem.find('[tmplayer-button="volume-down"]'),this.volumeMuteButton=this.$elem.find('[tmplayer-button="volume-mute"]'),this.volumeHalfButton=this.$elem.find('[tmplayer-button="volume-half"]'),this.volumeFullButton=this.$elem.find('[tmplayer-button="volume-full"]'),this.volumeToggleButtons=t(t.map([e.volumeMuteButton,e.volumeHalfButton,e.volumeFullButton],function(t){return t.get()})),this.$progressBarWrapper=this.$elem.find('[tmplayer-element="progress-bar-wrapper"]'),this.$progressBar=this.$elem.find('[tmplayer-element="progress-bar"]'),this.$duration=this.$elem.find('[tmplayer-element="duration"]'),this.$elapsed=this.$elem.find('[tmplayer-element="elapsed"]').text("0:00"),this.$volumeBarWrapper=this.$elem.find('[tmplayer-element="volume-bar-wrapper"]'),this.$volumeBar=this.$elem.find('[tmplayer-element="volume-bar"]'),this.$clickTargets=t("[tmplayer-click]"),this.$ajaxContainers=t('[tmplayer-dynamic-content="'+e.name+'"]'),this.targetSets.player=this.$elem.find('[tmplayer-interaction="monitor-state"]'),this.pauseButton.hide(),this.$progressBar.width("0%"),this.$volumeBar.width("100%"),t('[tmplayer-parent="'+e.name+'"]').each(function(t,n){e.initExternalSong(n)}),e.$elem.find('[tmplayer-element="audio"]').hide().each(function(t,n){e.grabAndSetSongData(n)}),0!=e.songs.length?(this.playButton.on("click",function(){e.playCurrentSong()}),this.stopButton.on("click",function(){e.stopCurrentSong()}),this.pauseButton.on("click",function(){e.pauseCurrentSong()}),this.volumeUpButton.on("click",function(){var t=e.getVolume()+.1;e.setVolume(t)}),this.volumeDownButton.on("click",function(){var t=e.getVolume()-.1;e.setVolume(t)}),this.volumeToggleButtons.on("click",function(){e.getVolume()>0?e.setVolume(0):e.setVolume(1)}),this.nextButton.on("click",function(){e.playNextSong()}),this.previousButton.on("click",function(){e.playPreviousSong()}),this.$clickTargets.on("click",function(){var n=t(this).attr("tmplayer-click");switch(n){case"play":e.playCurrentSong();break;case"pause":e.pauseCurrentSong();break;case"stop":e.stopCurrentSong();break;default:console.error(n+" does not exist on true music player.")}}),this.setVolume(1),this.initProgressBarEvents(),this.initVolumeBarEvents(),this.initAjaxLoadObserver(),this.initMediaAPIActions(),this.setCurrentSong(0)):console.error("There are no songs in the player.")},getVolume:function(){return this._volume},setVolume:function(t){t<0?t=0:t>1&&(t=1),this.volumeMuteButton.hide(),this.volumeHalfButton.hide(),this.volumeFullButton.hide(),0==(0==t?this.volumeMuteButton.show():t<.66?this.volumeHalfButton.show():this.volumeFullButton.show()).length&&this.volumeFullButton.show(),this._volume=t,this.getCurrentSong().audio.volume=t},playCurrentSong:function(){u.activePlayer&&u.activePlayer!=this&&u.activePlayer.pauseCurrentSong(),this.pauseButton.show(),this.playButton.hide(),this.getCurrentSong().audio.volume=this.getVolume(),u.activePlayer=this,this.getCurrentSong().audio.play()},stopCurrentSong:function(){this.pauseCurrentSong(),this.getCurrentSong().audio.currentTime=0},pauseCurrentSong:function(){this.pauseButton.hide(),this.playButton.show(),u.activePlayer=null,this.getCurrentSong().audio.pause()},toggleCurrentSong:function(){"playing"==this.getPlayerState()?this.pauseCurrentSong():this.playCurrentSong()},getCurrentSong:function(){return-1===this.getCurrentSongIndex()&&this.setCurrentSong(0),this.songs[this.getCurrentSongIndex()]},setCurrentSong:function(t){var e=this.songs[t];if(!e)return console.error("Song with index "+t+" not found."),!1;var n=this.songs[this._currentSongIndex];n&&n.$parentElem&&n.targetSetId!=e.targetSetId&&(n.$parentElem.removeClass("is-current"),this.targetSets[n.targetSetId].removeClass("is-current")),this._currentSongIndex=t,e.$parentElem&&(e.$parentElem.addClass("is-current"),this.targetSets[e.targetSetId].addClass("is-current"));var i=e.getThumbnail();i?this.$thumbnail.attr("src",i):this.$thumbnail.removeAttr("src"),this.$songName.text(e.title),this.$albumName.text(e.album),this.$artistName.text(e.artist),this.$duration.text(e.durationString),this.$genre.text(e.genre)},initProgressBarEvents:function(){var n=this;n.$progressBarWrapper.on("mousedown",function(i){n.isDragging=!0;var r=n.scrubSong(i),a=n.getCurrentSong().audio.duration;n.updateSongDisplayTime(r,a),t(e).on("mousemove.trueAudioPlayer",function(t){var e=n.scrubSong(t);n.updateSongDisplayTime(e,a)}),t(e).one("mouseup",function(){t(e).off("mousemove.trueAudioPlayer"),n.getCurrentSong().audio.currentTime=n.tempCurrentTime,n.isDragging=!1})})},initVolumeBarEvents:function(){var n=this;n.$volumeBarWrapper.on("mousedown",function(i){n.scrubVolume(i),t(e).on("mousemove.trueAudioPlayer",function(t){n.scrubVolume(t)}),t(e).one("mouseup",function(){t(e).off("mousemove.trueAudioPlayer")})})},scrubSong:function(t){var e=this.$progressBarWrapper.width(),n=this.$progressBarWrapper.offset().left,i=(t.clientX-n)/e;i<0?i=0:i>1&&(i=1);var r=this.getCurrentSong().audio.duration*(i=i<0?0:i);return this.tempCurrentTime=r,r},scrubVolume:function(t){var e=this.$volumeBarWrapper.width(),n=this.$volumeBarWrapper.offset().left,i=(t.clientX-n)/e;this.setVolume(i)},playNextSong:function(){if(1==this.songs.length)return!1;this.stopCurrentSong();var t=this.getCurrentSongIndex();this.songs[t+1]?t++:t=0,this.setCurrentSong(t),this.playCurrentSong()},playPreviousSong:function(){if(this.getCurrentSong().audio.currentTime>3)return this.getCurrentSong().audio.currentTime=0,!1;var t=this.getCurrentSongIndex();if(1==this.songs.length||0==t)return!1;this.stopCurrentSong(),this.songs[t-1]&&t--,this.setCurrentSong(t),this.playCurrentSong()},setPlayerState:function(t,e){if(t==this._playerState)return!1;this.$elem.removeClass("is-playing is-paused");var n=this.targetSets.player.removeClass("is-playing is-paused"),i=e.$parentElem;if(i){i.removeClass("is-playing is-paused");var r=this.targetSets[e.targetSetId].removeClass("is-playing is-paused")}switch(t){case"playing":this.$elem.addClass("is-playing"),n.addClass("is-playing"),i&&(i.addClass("is-playing"),r.addClass("is-playing")),"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:e.title,artist:e.artist,album:e.album})),this._playerState="playing";break;case"paused":this.$elem.addClass("is-paused"),n.addClass("is-paused"),i&&(i.addClass("is-paused"),r.addClass("is-paused")),this._playerState="paused";break;default:this._playerState="stopped"}},getPlayerState:function(){return this._playerState},getCurrentSongIndex:function(){return this._currentSongIndex},updateSongDisplayTime:function(t,e){var n=t/e*100,i=parseInt(t/60,10),r=parseInt(t%60);r=r>=10?r:"0"+r,this.$elapsed.text(i+":"+r),this.$progressBar.width(n+"%")},initAjaxLoadObserver:function(){var t=this;t.$ajaxContainers.each(function(e,n){new MutationObserver(function(e){e.forEach(function(e){e.addedNodes.forEach(function(e){e.getAttribute("tmplayer-parent")==t.name&&t.initExternalSong(e)})})}).observe(n,{subtree:!1,childList:!0})})},initExternalSong:function(e){var n=this,i=t(e),r=o();n.targetSets[r]=i.find('[tmplayer-interaction="monitor-state"]'),i.find('[tmplayer-action="none"]').on("click",function(t){t.stopPropagation()});var a=[i.find('[tmplayer-action="toggle"]')];"toggle"==i.attr("tmplayer-action")&&a.push(i);var s=t.map(a,function(t){return t.get()});t(s).on("click",function(t){var e=n.songs.map(function(t,e){return songMap={globalIndex:e,song:t}}).filter(function(t){return t.song.targetSetId==r}),i=n.getCurrentSong().id;e.filter(function(t){return t.song.id==i}).length>0?n.toggleCurrentSong():(n.stopCurrentSong(),n.setCurrentSong(e[0].globalIndex),n.playCurrentSong())}),t(e).find('[tmplayer-element="audio"]').hide().each(function(t,i){n.grabAndSetSongData(i,e,r)})},grabAndSetSongData:function(e,n,i){var r=t(e),o=n?t(n):void 0,s=new a(this,r.children('[tmplayer-meta="audio-url"]').text(),r,i);s.$parentElem=o,s.title=r.children('[tmplayer-meta="title"]').text(),s.artist=r.children('[tmplayer-meta="artist"]').text(),s.genre=r.children('[tmplayer-meta="genre"]').text(),s.album=r.children('[tmplayer-meta="album"]').text(),r.children('[tmplayer-meta="thumbnail"]').text()?s.setThumbnail(r.children('[tmplayer-meta="thumbnail"]').text()):r.children('[tmplayer-meta="thumbnail"]').attr("src")&&s.setThumbnail(r.children('[tmplayer-meta="thumbnail"]').attr("src")),this.songs.push(s)},initMediaAPIActions:function(){var t=this,e=[["play",function(){t.playCurrentSong()}],["pause",function(){t.pauseCurrentSong()}],["previoustrack",function(){t.playPreviousSong()}],["nexttrack",function(){t.playNextSong()}],["stop",function(){t.stopCurrentSong()}],["seekbackward",function(e){var n=e.seekOffset||10;t.getCurrentSong().audio.currentTime=Math.max(t.getCurrentSong().audio.currentTime-n,0)}],["seekforward",function(e){var n=e.seekOffset||10;t.getCurrentSong().audio.currentTime=Math.max(t.getCurrentSong().audio.currentTime+n,t.getCurrentSong().audio.duration)}],["seekto",function(e){t.getCurrentSong().audio.currentTime=e.seekTime}]];for(var[n,i]of e)try{navigator.mediaSession.setActionHandler(n,i)}catch(t){console.log("The media session action "+n+" is not supported yet.")}}},t.fn.extend({trueAudioPlayer:function(e){var n={};return n[e]?n[e].apply(t(this).data("plugin_trueAudioPlayer"),Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void console.error("Method "+e+" does not exist on True Audio Player"):this.each(function(){t.data(this,"plugin_trueAudioPlayer")||t.data(this,"plugin_trueAudioPlayer",new s(this,e))})}});var u=new function(){this.activePlayer=null,this.initializePlayers=function(){t("[tmplayer-init]").trueAudioPlayer()}};u.initializePlayers()}(jQuery,window,document);